# Migration `20211019102847-comments`

This migration has been generated by roluochKe at 10/19/2021, 1:28:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."User" ALTER COLUMN "password" SET DEFAULT E''

CREATE TABLE "public"."Following" (
"id" SERIAL,
"name" text   NOT NULL ,
"avatar" text   NOT NULL ,
"followId" integer   NOT NULL ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"content" text   ,
"tweetId" integer   ,
"userId" integer   ,
"commentId" integer   ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."Following" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("tweetId")REFERENCES "public"."Tweet"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY("commentId")REFERENCES "public"."Comment"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20211019094153-likes..20211019102847-comments
--- datamodel.dml
+++ datamodel.dml
@@ -3,21 +3,51 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
+model Tweet {
+  id        Int          @id @default(autoincrement())
+  createdAt DateTime     @default(now())
+  content   String?
+  likes     LikedTweet[]
+  author    User?        @relation(fields: [authorId], references: [id])
+  authorId  Int?
+  comments  Comment[]
+}
+
 model User {
   id         Int          @id @default(autoincrement())
   email      String       @unique
-  password   String
+  password   String       @default("")
   name       String?
+  tweets     Tweet[]
   Profile    Profile?
-  Tweet      Tweet[]
-  LikedTweet LikedTweet[]
+  likedTweet LikedTweet[]
+  comments   Comment[]
+  Following  Following[]
 }
+model LikedTweet {
+  id      Int      @id @default(autoincrement())
+  tweet   Tweet    @relation(fields: [tweetId], references: [id])
+  likedAt DateTime @default(now())
+  userId  Int?
+  User    User?    @relation(fields: [userId], references: [id])
+  tweetId Int
+}
+
+model Following {
+  id       Int    @id @default(autoincrement())
+  name     String
+  avatar   String
+  followId Int
+  User     User?  @relation(fields: [userId], references: [id])
+  userId   Int?
+}
+
 model Profile {
   id        Int      @id @default(autoincrement())
   createdAt DateTime @default(now())
   bio       String?
@@ -27,21 +57,16 @@
   userId    Int?     @unique
   User      User?    @relation(fields: [userId], references: [id])
 }
-model Tweet {
-  id        Int          @id @default(autoincrement())
-  createdAt DateTime     @default(now())
+model Comment {
+  id        Int       @id @default(autoincrement())
+  createdAt DateTime  @default(now())
   content   String?
-  likes     LikedTweet[]
-  author    User?        @relation(fields: [authorId], references: [id])
-  authorId  Int?
+  Tweet     Tweet?    @relation(fields: [tweetId], references: [id])
+  tweetId   Int?
+  User      User?     @relation(fields: [userId], references: [id])
+  userId    Int?
+  comments  Comment[] @relation("CommentToComment")
+  Comment   Comment?  @relation("CommentToComment", fields: [commentId], references: [id])
+  commentId Int?
 }
-
-model LikedTweet {
-  id      Int      @id @default(autoincrement())
-  tweet   Tweet    @relation(fields: [tweetId], references: [id])
-  likedAt DateTime @default(now())
-  userId  Int?
-  User    User?    @relation(fields: [userId], references: [id])
-  tweetId Int
-}
```


